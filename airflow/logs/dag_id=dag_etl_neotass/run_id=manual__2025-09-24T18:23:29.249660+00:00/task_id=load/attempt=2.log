[2025-09-24T18:33:36.511+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: dag_etl_neotass.load manual__2025-09-24T18:23:29.249660+00:00 [queued]>
[2025-09-24T18:33:36.804+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: dag_etl_neotass.load manual__2025-09-24T18:23:29.249660+00:00 [queued]>
[2025-09-24T18:33:36.815+0000] {taskinstance.py:2170} INFO - Starting attempt 2 of 2
[2025-09-24T18:33:37.074+0000] {taskinstance.py:2191} INFO - Executing <Task(PythonOperator): load> on 2025-09-24 18:23:29.249660+00:00
[2025-09-24T18:33:37.157+0000] {standard_task_runner.py:60} INFO - Started process 331 to run task
[2025-09-24T18:33:37.195+0000] {standard_task_runner.py:87} INFO - Running: ['***', 'tasks', 'run', 'dag_etl_neotass', 'load', 'manual__2025-09-24T18:23:29.249660+00:00', '--job-id', '17', '--raw', '--subdir', 'DAGS_FOLDER/dag_etl_neotass.py', '--cfg-path', '/tmp/tmpd7lwh4x6']
[2025-09-24T18:33:37.210+0000] {standard_task_runner.py:88} INFO - Job 17: Subtask load
[2025-09-24T18:33:37.624+0000] {task_command.py:423} INFO - Running <TaskInstance: dag_etl_neotass.load manual__2025-09-24T18:23:29.249660+00:00 [running]> on host 5c897a302498
[2025-09-24T18:33:38.368+0000] {taskinstance.py:2480} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='dag_etl_neotass' AIRFLOW_CTX_TASK_ID='load' AIRFLOW_CTX_EXECUTION_DATE='2025-09-24T18:23:29.249660+00:00' AIRFLOW_CTX_TRY_NUMBER='2' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-09-24T18:23:29.249660+00:00'
[2025-09-24T18:33:39.942+0000] {logging_mixin.py:188} INFO - Inserted rows 0 to 1000 into dim_parceiro
[2025-09-24T18:33:40.019+0000] {taskinstance.py:2698} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 733, in do_executemany
    cursor.executemany(statement, parameters)
sqlite3.IntegrityError: NOT NULL constraint failed: dim_produto.valor_unitario

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 433, in _execute_task
    result = execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 199, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 216, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/dag_etl_neotass.py", line 122, in load
    dim_produto_df_chunk.to_sql('dim_produto', con=engine, if_exists='append', index=False)
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/core/generic.py", line 2878, in to_sql
    return sql.to_sql(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 769, in to_sql
    return pandas_sql.to_sql(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1920, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1470, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1461, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1023, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 929, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 733, in do_executemany
    cursor.executemany(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: dim_produto.valor_unitario
[SQL: INSERT INTO dim_produto (id_produto, nome_produto, categoria_produto, valor_unitario) VALUES (?, ?, ?, ?)]
[parameters: ((1, 'LiteTab Pro', 'Tablet', 2871.09), (2, 'QuantumPad Ultra', 'Tablet', 2854.77), (3, 'InfinityTab X', 'Tablet', 3550.9), (4, 'InfinityTab s', 'Tablet', 572.16), (5, 'Collaboration Edge', 'Business TV', 4685.77), (6, 'Collaboration Elite', 'Business TV', 1492.58), (7, 'InfinityMeeting Pro', 'Business TV', 2181.56), (8, 'Quantum X', 'Smartphone', 3979.75)  ... displaying 10 of 53 total bound parameter sets ...  (52, 'Infinity tab S', 'Tablet', 572.16), (53, 'InfinityTab S', 'Tablet', None))]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
[2025-09-24T18:33:40.164+0000] {taskinstance.py:1138} INFO - Marking task as FAILED. dag_id=dag_etl_neotass, task_id=load, execution_date=20250924T182329, start_date=20250924T183336, end_date=20250924T183340
[2025-09-24T18:33:40.286+0000] {standard_task_runner.py:107} ERROR - Failed to execute job 17 for task load ((sqlite3.IntegrityError) NOT NULL constraint failed: dim_produto.valor_unitario
[SQL: INSERT INTO dim_produto (id_produto, nome_produto, categoria_produto, valor_unitario) VALUES (?, ?, ?, ?)]
[parameters: ((1, 'LiteTab Pro', 'Tablet', 2871.09), (2, 'QuantumPad Ultra', 'Tablet', 2854.77), (3, 'InfinityTab X', 'Tablet', 3550.9), (4, 'InfinityTab s', 'Tablet', 572.16), (5, 'Collaboration Edge', 'Business TV', 4685.77), (6, 'Collaboration Elite', 'Business TV', 1492.58), (7, 'InfinityMeeting Pro', 'Business TV', 2181.56), (8, 'Quantum X', 'Smartphone', 3979.75)  ... displaying 10 of 53 total bound parameter sets ...  (52, 'Infinity tab S', 'Tablet', 572.16), (53, 'InfinityTab S', 'Tablet', None))]
(Background on this error at: https://sqlalche.me/e/14/gkpj); 331)
[2025-09-24T18:33:40.454+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 1
[2025-09-24T18:33:40.746+0000] {taskinstance.py:3280} INFO - 0 downstream tasks scheduled from follow-on schedule check
